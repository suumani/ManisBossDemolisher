# Manis Boss Demolisher — 仕様書（spec）

本書は Manis Boss Demolisher の **設計意図・仕様・合意事項** を記録するためのドキュメントである。  
Mod Portal や README では説明しきれない「判断基準」「世界観上の前提」「仕様の優先順位」を保持することを目的とする。

---

## 0. 目的と非目的

### 0.1 目的（Purpose）

- デモリッシャーを「一時的な障害物」ではなく、  
  **惑星単位で影響を及ぼす主役級の脅威**として再定義する
- ロケット打ち上げ・宇宙進出を、  
  **常にリスクを伴う意思決定**へと変化させる
- プレイヤーに対し、
  - 惑星攻略順序
  - 輸送計画
  - 放置・撤退・回避
  という選択を強く意識させる

### 0.2 非目的（Non-goals）

- すべてのボスを撃破可能にすることは目的としない
- デモリッシャーを「必ず戦う敵」にすることは目的としない
- 単純な数値強化・高難度化を目的としない
- 既存の戦闘バランスを完全に破壊することは意図しない

---

## 1. Mod の位置づけ

- 分類：コンテンツ追加 / 敵挙動・世界状態拡張
- 対象環境：Factorio 2.0+ / Space Age
- 適用範囲：
  - デモリッシャーが存在する惑星
- コアファンタジー：
  - 「宇宙へ進出するほど、世界は危険になる」

---

## 2. プレイヤー体験の基本構造

1. 惑星上で活動し、ロケットを打ち上げる
2. その行為がトリガーとなり、別惑星の状況が変化する
3. 侵略・拡散したデモリッシャーにより、脅威が増大する
4. プレイヤーは以下を選択する：
   - 対応する
   - 後回しにする
   - 回避・放棄する

※ 本 Mod では、あまりに強力なデモリッシャーは回避対象として想定している

---

## 3. システム仕様概要

### 3.1 ボス級デモリッシャー

- 通常のデモリッシャーとは異なる、
  **高い耐久・攻撃力・存在感を持つ個体**
- 複数段階の強さを持つ：
  - 小型
  - 中型
  - 大型
  - ベヒモス級
- 段階が上がるほど：
  - 撃破難易度が上昇
  - 回避・放置の判断が現実的になる

---

### 3.2 ロケット打ち上げによる侵略拡散

- ロケットの打ち上げは、
  **他惑星におけるデモリッシャー活動を活性化させるトリガー**となる
- 拡散先・影響範囲・強度は、
  - 惑星の状態
  - 既存の侵略状況
  に依存する
- 輸出判定：ロケット発射時、輸出（侵略拡散）イベントは必ず実行される（確率で抑止しない）。
- 輸出上限：輸出先惑星（dest_surface）ごとに、生存デモリッシャー総数が cap(evo) 以上の場合は新規輸出スポーンしない。cap(evo)=floor(evo*10)、ただし evo>=0.99 は cap=20。
- 輸出トリガ条件：
  - 以下のいずれかを満たすロケット発射を輸出（侵略拡散）の対象とする。
    1) Vulcanus におけるロケット発射
    2) Vulcanus 以外の惑星において、その惑星でデモリッシャー撃破済みの場合のロケット発射

- evo の参照元：
  - cap(evo) に用いる evo は、輸出元惑星（trigger_surface）の進化度を指す。

- 生存デモリッシャー総数の定義：
  - 「生存デモリッシャー総数」とは、輸出先惑星（dest_surface）上に存在する、
    敵勢力かつ DemolisherNames.ALL に該当する全個体数を指す。

- 輸出メッセージ表示：
  - 輸出（侵略拡散）を示すメッセージはロケット発射時に表示される。
  - ただし、表示頻度は最大で30分に1回に抑止される。

※ ロケット＝進行度上昇ではなく、  
※ ロケット＝世界を揺るがす行為、という位置づけ
※ 厳密にロケット輸送計画を立てる必要に迫られる

---

### 3.3 惑星ごとの状態管理

- 惑星単位で以下の状態が管理される：
  - ボスデモリッシャー撃破済み / 未撃破
  - 侵略進行中 / 停滞 / 収束
- 状態に応じて：
  - 出現個体
  - 行動傾向
  - 影響度
  が変化する

---

### 3.4 プレイヤー活動への反応

- 巨大種のデモリッシャー以外は、
  - ロケット発射音
  に反応して移動・接近する
- 「放置していれば安全」とは限らない状況を生む
- 巨大種はマップ上の固定障害物との思想からこのような差分を設けた

---

## 4. 難易度と設計方針

- 難易度設定項目：
  - 原則として設けない
- 想定される難易度：
  - 倒せない敵が存在することを前提とする
  - 戦わない判断が正解となる場面が存在する
- 本 Mod における「失敗」：
  - 基地が壊れることではなく、
  - 打開困難な状況まで放置すること

---

## 5. 互換性ポリシー

- グローバルな敵 AI・挙動は極力変更しない
- 他 Mod との干渉が生じる場合：
  - 惑星単位・デモリッシャー関連に限定する
- 明示的に非対応とする場合は README に記載する

---

## 6. セーブデータと決定性

- 使用するグローバルデータ：
  - storage.manis_boss_demolisher_flag
- マルチプレイ時の挙動：
  - 決定性を前提とする
  - 問題が発生した場合はバグとして扱う

---

## 7. 開発状況とロードマップ

- 現在：
  - 侵略拡散ロジックは実装済み
  - 惑星ごとの状態管理は安定段階
- 今後：
  - 大規模な機能追加は予定しない
  - バランス調整・互換性調整を中心とする

---

## 8. 本 spec の扱い

- 本書は README および Mod Portal の記述より優先される
- 実装と乖離が生じた場合：
  - 実装を仕様とみなすか
  - spec を更新するか
  を明示的に判断する